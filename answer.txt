gemini

### Response Passport: Gemini 3 Flash | Marker: GEC_Podija_Core_v303.0

**–†–µ–∑—é–º–µ:** –û–Ω–æ–≤–ª–µ–Ω–æ `core/telegram_bot.py`. –Ø —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞–≤ —Ñ—ñ–Ω–∞–ª—å–Ω—É –≤–µ—Ä—Å—ñ—é –ø—Ä–æ–º–ø—Ç—É –¥–ª—è –º–æ–¥—É–ª—è **–ü–æ–î—ñ—è**, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É (**2026-02-08**) —è–∫ –∞–±—Å–æ–ª—é—Ç–Ω—É —Ç–æ—á–∫—É –≤—ñ–¥–ª—ñ–∫—É. –ö–æ–¥ –≤–∫–ª—é—á–∞—î –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –¥–ª—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ —ñ –≥–∞—Ä–∞–Ω—Ç—É—î –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤–∏–∫–ª—é—á–Ω–æ –≤–∞–ª—ñ–¥–Ω–æ–≥–æ JSON-–æ–±'—î–∫—Ç–∞ –¥–ª—è –≤–∞—à–æ—ó —Å–∏—Å—Ç–µ–º–∏.

---

### üèõÔ∏è –û–Ω–æ–≤–ª–µ–Ω–∏–π `core/telegram_bot.py`

–¶–µ–π —Å–∫—Ä–∏–ø—Ç —î —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–º –≤—É–∑–ª–æ–º –æ–±—Ä–æ–±–∫–∏ —ñ–Ω—Ç–µ–Ω—Ç—ñ–≤ —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó **cit**. –í—ñ–Ω –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –≤—ñ–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Ñ–∞–∫—Ç.

```python
import datetime
import json

def get_event_extraction_prompt(user_text):
    """
    –§–æ—Ä–º—É—î —Å—É–≤–æ—Ä–∏–π —Å–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –º–æ–¥—É–ª—è –ü–æ–î—ñ—è.
    –°—å–æ–≥–æ–¥–Ω—ñ: 2026-02-08 (–ù–µ–¥—ñ–ª—è).
    """
    now = datetime.datetime.now()
    today_iso = now.strftime("%Y-%m-%d")
    weekday = now.strftime("%A")

    # –°–£–í–û–†–ò–ô –°–ò–°–¢–ï–ú–ù–ò–ô –ü–†–û–ú–ü–¢ (–ë–õ–û–ö–£–í–ê–ù–ù–Ø –ì–ê–õ–Æ–¶–ò–ù–ê–¶–Ü–ô)
    return f"""
[SYSTEM CONTEXT]
Today's Date: {today_iso}
Day of Week: {weekday}
Module: –ü–æ–î—ñ—è (Podija)

[TASK]
Extract event details from the user text and return them as a clean JSON object.

[STRICT RULES]
1. OUTPUT: Return ONLY raw JSON. No markdown blocks, no triple backticks, no intro text.
2. FIELDS: "title", "date", "time", "desc".
3. DATE: Calculate the absolute date based on {today_iso}.
4. NO PLACEHOLDERS: NEVER return strings like "YYYY-MM-DD". Use actual numeric values.
5. DEFAULTS: If time is not mentioned, use "09:00". If desc is missing, use "".
6. LANGUAGE: Maintain the user's language for 'title' and 'desc'.

[USER INPUT]
"{user_text}"

[JSON OUTPUT]
"""

def parse_podija_response(raw_response):
    """
    –í–∏—Ç—è–≥—É—î —Ç–∞ –≤–∞–ª—ñ–¥—É—î –¥–∞–Ω—ñ, –≤—ñ–¥–∫–∏–¥–∞—é—á–∏ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —à–∞–±–ª–æ–Ω–∏.
    """
    try:
        # –û—á–∏—â–µ–Ω–Ω—è –≤—ñ–¥ markdown-—Ç–µ–≥—ñ–≤ —Ç–∞ –∑–∞–π–≤–∏—Ö –ø—Ä–æ–±—ñ–ª—ñ–≤
        clean_str = raw_response.strip().replace("```json", "").replace("```", "").strip()
        data = json.loads(clean_str)
        
        # –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —à–∞–±–ª–æ–Ω—ñ–≤ (YYYY)
        date_str = str(data.get("date", ""))
        if "YYYY" in date_str or "-" not in date_str:
            # –ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è: —è–∫—â–æ AI —Å—Ö–∏–±–∏–≤, —Å—Ç–∞–≤–∏–º–æ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É
            data["date"] = datetime.datetime.now().strftime("%Y-%m-%d")
            
        return data
    except (json.JSONDecodeError, Exception):
        return None

if __name__ == "__main__":
    # –¢–µ—Å—Ç: "–Ω–∞—Å—Ç—É–ø–Ω–æ—ó —Å–µ—Ä–µ–¥–∏ –æ–± 11:00 –∑—É—Å—Ç—Ä—ñ—á"
    test_phrase = "–Ω–∞—Å—Ç—É–ø–Ω–æ—ó —Å–µ—Ä–µ–¥–∏ –æ–± 11:00 –∑—É—Å—Ç—Ä—ñ—á"
    print(get_event_extraction_prompt(test_phrase))

```

---

### üõ†Ô∏è –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞—É–¥–∏—Ç (111 Density)

* **–î–∏–Ω–∞–º—ñ—á–Ω–∞ –ø—Ä–∏–≤'—è–∑–∫–∞:** AI –æ—Ç—Ä–∏–º—É—î `{today_iso}` —É –∫–æ–∂–Ω–æ–º—É –∑–∞–ø–∏—Ç—ñ, —â–æ –¥–æ–∑–≤–æ–ª—è—î –π–æ–º—É –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ ¬´–Ω–∞—Å—Ç—É–ø–Ω–æ—ó —Å–µ—Ä–µ–¥–∏¬ª –Ω–∞ `2026-02-11`.
* **–ó–∞–±–æ—Ä–æ–Ω–∞ Placeholders:** –ü—Ä—è–º–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è `NO PLACEHOLDERS` —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä —É `parse_podija_response` —É—Å—É–≤–∞—é—Ç—å —Ä–∏–∑–∏–∫ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö —à–∞–±–ª–æ–Ω—ñ–≤.
* **–°—Ç–µ—Ä–∏–ª—å–Ω—ñ—Å—Ç—å:** –§–æ—Ä–º—É–ª—é–≤–∞–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—É —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–µ –Ω–∞ –º–∏—Ç—Ç—î–≤—É –æ–±—Ä–æ–±–∫—É –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, —â–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ Termux.

---

### ‚öôÔ∏è –°—Ç–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ

–ê—É–¥–∏—Ç –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î: —Ü–µ–π –≤—É–∑–æ–ª –≥–æ—Ç–æ–≤–∏–π. –ú–∏ –≤–∏–∫–æ–Ω–∞–ª–∏ –ö—Ä–æ–∫ 1 –Ω–∞—à–æ—ó –ª–æ–≥—ñ—á–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ. –¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –≤–º—ñ—î *—Ä–æ–∑—É–º—ñ—Ç–∏* –ü–æ–î—ñ—é –∑–∞ –Ω–æ–≤–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.

**–ß–∏ –±–∞–∂–∞—î—Ç–µ –≤–∏, —â–æ–± —è —Ç–µ–ø–µ—Ä –ø—ñ–¥–≥–æ—Ç—É–≤–∞–≤ –∑–º—ñ–Ω–∏ –¥–ª—è `backend/main.py`, —è–∫—ñ –∑–∞–±–µ–∑–ø–µ—á–∞—Ç—å —Ñ—ñ–∑–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ü—å–æ–≥–æ JSON —É —Ñ–∞–π–ª `calendar.json` —É –≤–∞—à–æ–º—É —Å—Ö–æ–≤–∏—â—ñ `storage/shared/`?** üöÄ


gpt

–°—Ç–≤–æ—Ä–µ–Ω–æ –ø–æ–≤–Ω–∏–π –±–µ–∫–µ–Ω–¥ –¥–ª—è ‚ÄúCi Moment‚Äù –∑–≥—ñ–¥–Ω–æ –≤–∏–º–æ–≥. –ù–∏–∂—á–µ ‚Äì –∫–ª—é—á–æ–≤—ñ —Ñ–∞–π–ª–∏ —Ç–∞ —ó—Ö –≤–º—ñ—Å—Ç.

### lib/engine.ts

* –ì–µ–Ω–µ—Ä—É—î –∫–æ–¥ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—É —Ñ–æ—Ä–º–∞—Ç—É `ci-XX-XXXXX`.
* –í–∏–∑–Ω–∞—á–∞—î —Å—Ç–∞—Ç—É—Å –∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Ç–∞ —Ö–≤–∏–ª–∏–Ω–æ—é.
* –°—Ç–≤–æ—Ä—é—î verify-—Ö–µ—à (16 —Å–∏–º–≤–æ–ª—ñ–≤ SHA‚Äë256) –¥–ª—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
* –ï–∫—Å–ø–æ—Ä—Ç—É—î –º–∞–ø–∏ CONTEXT_IDS —Ç–∞ STATUSES.

–§–∞–π–ª: {{file:file-MUMX7AproC7tG5yoTHNZgX}}

### lib/supabase.ts

* –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î Supabase‚Äë–∫–ª—ñ—î–Ω—Ç –∑ —Å–µ—Ä–≤—ñ—Å–Ω–∏–º –∫–ª—é—á–µ–º.
* `createArtifact` ‚Äì –≤—Å—Ç–∞–≤–ª—è—î –Ω–æ–≤–∏–π –∑–∞–ø–∏—Å (—â–µ –Ω–µ sealed).
* `sealArtifact` ‚Äì –ø–æ–∑–Ω–∞—á–∞—î –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —è–∫ sealed, –∑–∞–ø–∏—Å—É—î —á–∞—Å —Ç–∞ ID —Å–µ—Å—ñ—ó.
* `getArtifactByHash` ‚Äì –æ—Ç—Ä–∏–º—É—î –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∑–∞ verify‚Äë—Ö–µ—à–µ–º –∞–±–æ –ø–æ–≤–µ—Ä—Ç–∞—î null.
* –û–ø–∏—Å–∞–Ω—ñ —Ç–∏–ø–∏ `Artifact` —Ç–∞ `ArtifactInput`.

–§–∞–π–ª: {{file:file-VZ2AnLYGPDXMZy7bBVouU2}}

### app/api/seal/route.ts

* –û–±—Ä–æ–±–ª—è—î POST: –ø–µ—Ä–µ–≤—ñ—Ä—è—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –π —Å—Ç–∞—Ç—É—Å –∑–∞ –ø—Ä–∞–≤–∏–ª–æ–º (minute + context).
* –°—Ç–≤–æ—Ä—é—î verify‚Äë—Ö–µ—à, –∑–∞–ø–∏—Å—É—î –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —É Supabase.
* –ì–µ–Ω–µ—Ä—É—î Stripe Checkout Session ($5, ‚ÄúCi Moment Seal‚Äù), –¥–æ–¥–∞—î metadata (artifact_code, verify_hash), –ø–æ–≤–µ—Ä—Ç–∞—î `checkoutUrl`.

–§–∞–π–ª: {{file:file-G217qA4xqCJMhU1yehtYPn}}

### app/api/webhook/route.ts

* –ü—Ä–∏–π–º–∞—î Stripe webhook, —á–∏—Ç–∞—î raw body –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—ñ–¥–ø–∏—Å—É.
* –ü—ñ—Å–ª—è `checkout.session.completed` –≤–∏–∫–ª–∏–∫–∞—î `sealArtifact`.
* –ü–æ–≤–µ—Ä—Ç–∞—î 200 OK –∞–±–æ 400 —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ –ø—ñ–¥–ø–∏—Å—É.

–§–∞–π–ª: {{file:file-EErKczKNHyNEW7wxkoDvgi}}

### app/verify/[hash]/page.tsx

* –°–µ—Ä–≤–µ—Ä–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∑–∞ verify‚Äë—Ö–µ—à–µ–º.
* –Ø–∫—â–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —ñ—Å–Ω—É—î —Ç–∞ sealed ‚Äì –ø–æ–∫–∞–∑—É—î ‚ÄúIssued: YES‚Äù –∑ –∫–æ–¥–æ–º, —Å—Ç–∞—Ç—É—Å–æ–º —ñ —á–∞—Å–æ–º (UTC).
* –Ø–∫—â–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –Ω–µ sealed ‚Äì –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚ÄúArtifact not found‚Äù.
* –ú—ñ–Ω—ñ–º–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π –¥–∏–∑–∞–π–Ω: —Ç–µ–º–Ω–∏–π —Ñ–æ–Ω, –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω–∏–π —à—Ä–∏—Ñ—Ç.

–§–∞–π–ª: {{file:file-4TLBEFuvL2NsxzcgqeQnoG}}

### .env.example

–®–∞–±–ª–æ–Ω –¥–ª—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è:

* `NEXT_PUBLIC_URL`
* `SUPABASE_URL`
* `SUPABASE_SERVICE_KEY`
* `STRIPE_SECRET_KEY`
* `STRIPE_WEBHOOK_SECRET`

–§–∞–π–ª: {{file:file-4ymooyq3BncHM8TEuP6hwK}}

–¶—ñ —Ñ–∞–π–ª–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å –∑–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ UI, –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å —Å—É–≤–æ—Ä–æ–≥–æ TypeScript —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±—Ä–æ–±–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫.


